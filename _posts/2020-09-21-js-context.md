---
title: "[Javascript] 02. 실행 컨텍스트"
categories: 
  - Javascript
toc: true
---

**해당 챕터는 Inside Javascript를 참고하여 작성했습니다.**

# 실행 컨텍스트란?

ECMAScript에서는 실행 컨텍스트를 **실행 가능한 코드를 형상화히고 구분하는 추상적인 개념**으로 기술한다.  
이를 좀 더 쉽게 설명하면 **실행 가능한 자바스크립트 코드 블록이 실행되는 환경**이라고 할 수 있다.

실행 가능한 자바스크립트 코드란
- 전역 코드
- eval() 함수로 실행되는 코드
- 함수 안의 코드를 실행할 경우

***대부분은 함수로 실행 컨텍스트를 만든다.***

코드가 실행되면 실행 컨텍스트가 생성되고 스택에 쌓인다. 제일 위(top)에 위치하는 실행 컨텍스트가 현재 실행되는 컨텍스트다. ECMAScript에서는 실행 컨텍스트의 생성을 다음처럼 설명한다.

**현재 실행되는 컨텍스트에서 이 컨텍스트와 관련 없는 코드가 실행되면, 새로운 컨텍스트가 생성되어 스택에 들어가고 제어권이 그 컨텍스트로 이동한다.**

다음 예제를 살펴보자


```js
console.log("This is global context");

function ExContext1() {
    console.log("This is ExContext1");
}

function ExContext2() {
    ExContext1();
    console.log("This is ExContext2");
}

ExContext2();
```

[출력결과]
```
This is global context
This is ExContext1
This is ExContext2
```



![js-context-img001]({{site.url}}/assets/images/js-context-img001.png)

위 그림을 살펴보면 실행 컨텍스트 스택에 호출 순서대로 쌓이고 함수 실행이 완료되면 스택에서 없어진다.



# 실행 컨텍스트 생성 과정

자바스크립트에서 함수를 실행하여 실행 컨텍스트가 생성되면 자바스크립트 엔진은 다음과 같은 일을 정해진 순서대로 실행한다.

1. 활성 객체(Activation Object) 생성
2. arguments 객체 생성
3. Scope 정보 생성
4. 변수 생성
5. this 바인딩

## 활성 객체 생성

실행 컨텍스트가 생성되면 자바스크립트 엔진은 해당 컨텍스트에서 실행에 필요한 여러 가지 정보를 담을 객체를 생성하는데, 이를 **활성 객체**라고 한다. 

## arguments 객체 생성

함수의 전달인자를 활성 객체에 저장한다.

## 스코프 정보 생성

현재 컨텍스트의 유효 범위를 나타내는 스코프 정보를 생성한다. 이 스코프 정보는 현재 실행중인 실행 컨텍스트 안에서 연결 리스트와 유사한 형식으로 만들어진다. 즉, 현재 컨텍스트의 스코프는 상위 컨텍스트의 스코프와 연결돼있다. 이 리스트를 스코프 체인이라고 하는데, [[scope]] 프로퍼티로 참조된다.

## 변수 생성

함수 내부에 정의된 변수가 생성된다. 여기서 주의할 점은 **이 과정에서는 변수나 내부 함수를 단지 메모리에 생성(instanitaion) 할 뿐**, 초기화(initialziation)는 각 변수나 함수에 해당하는 표현식이 실행 되기 전까지는 이루어지지 않는다는 점이다.

## this 바인딩

마지막 단계에서는 this키워드를 사용하는 값이 할당된다. 여기서 this가 참조하는 객체가 없으면 전역 객체를 참조한다.

# 스코프 체인

실행 컨텍스트가 생성 될 때, 스코프 체인도 같이 생성된다고 앞서 배웠다. 스코프 체인을 설명하기 앞서 간단히 스코프를 말하자면 스코프는 변수와 함수의 유효범위라고 할수 있다.

현재 실행 컨텍스트에서 어떤 변수 x를 찾을 때 현재 실행 컨텍스트의 변수 객체에서 변수 x를 찾고 없을 경우 스코프 체인, [[scope]] 프로퍼티를 사용해서 상위 컨텍스트의 스코프를 탐색한다.

## 스코프 체인 간단정리
- 각 함수 객체는 [[scope]] 프로퍼티로 현재 컨텍스트의 스코프 체인을 참조한다.
- 새로 생성된 실행컨텍스트는 다음과 같은 방법으로 스코프 체인을 만든다.
    - 현재 실행되는 함수 객체의 [[scope]] 프로퍼티를 복사.
    - 새롭게 생성된 변수 객체를 해당 체인의 제일 앞에 추가.

**스코프 체인 = 현재 실행 컨텍스트의 변수 객체 + 상위 컨텍스트의 스코프 체인**

